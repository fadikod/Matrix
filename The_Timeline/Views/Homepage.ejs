<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discussion Board</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="../public/style.css" />
</head>

<body class="bg-white">

  <main class="container py-5" style="max-width: 900px">

    <!-- Header -->
    <header class="mb-5">
      <h2 class="fw-bold">Open Discussion</h2>
      <p class="text-muted">
        A shared space for thoughts, reflections, and responses.
      </p>
    </header>

    <!-- Write entry -->
    <section class="mb-5 p-4 bg-light rounded border">
      <h5 class="mb-3">Start a new entry</h5>
      <form action="/add-post" method="POST">
        <textarea
          name="body"
          class="form-control mb-3"
          rows="4"
          minlength="25"
          required
          placeholder="Write at least 25 characters..."
        ></textarea>
        <button class="btn btn-primary">Submit entry</button>
      </form>
    </section>

    <!-- Entries -->
    <% posts.forEach(post => { %>
      <article class="mb-5">

        <!-- Entry meta -->
        <div class="mb-2 text-muted small">
          <strong class="text-dark">
            <%= post.userId ? post.userId.first_name + " " + post.userId.last_name : "Anonymous user" %>
          </strong>
          Â· <%= post.createdAt.toDateString() %>
        </div>

        <!-- Entry content -->
        <div class="p-3 border rounded mb-4">
          <%= post.body %>
        </div>

        <!-- Responses -->
        <div class="ms-4 mb-4">
          <% comments.forEach(comment => { %>
            <% if (comment.postId.toString() === post._id.toString()) { %>
              <div class="mb-3">
                <div class="small text-muted">
                  <strong class="text-dark">
                    <%= comment.userId ? comment.userId.first_name : "Guest" %>
                  </strong>
                  responded on <%= comment.createdAt.toDateString() %>
                </div>
                <div class="ps-3 border-start">
                  <%= comment.body %>
                </div>
              </div>
            <% } %>
          <% }) %>
        </div>

        <!-- Response form -->
        <details>
          <summary class="text-primary mb-2" style="cursor:pointer">
            Add a response
          </summary>
          <form
            action="/posts/<%= post._id %>/comment"
            method="POST"
            class="mt-3"
          >
            <textarea
              name="comment"
              class="form-control mb-2"
              rows="2"
              minlength="25"
              required
              placeholder="Your response (min 25 characters)"
            ></textarea>
            <button class="btn btn-outline-secondary btn-sm">
              Send response
            </button>
          </form>
        </details>

        <hr class="mt-5" />
      </article>
    <% }) %>

  </main>

</body>
</html>